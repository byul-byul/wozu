---

# üì¶ `video/` ‚Äî –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å –≤–∏–¥–µ–æ

## üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∑–∞–≥—Ä—É–∑–∫—É, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ WOZU. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–∏–¥–µ–æ –≤ MinIO —á–µ—Ä–µ–∑ presigned URL, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –ø–æ—Å–ª–µ–¥—É—é—â—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (–∞–Ω–∞–ª–∏–∑ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∏ –ø—Ä.).

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

* `routes.py` ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã API
* `models.py` ‚Äî SQLAlchemy –º–æ–¥–µ–ª—å `Video`
* `schemas.py` ‚Äî Pydantic-—Å—Ö–µ–º—ã `VideoCreate`, `VideoRead`, `PresignResponse`, `VideoStatus`
* `crud.py` ‚Äî –±–∞–∑–æ–≤—ã–π CRUD (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏)
* `service.py` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è presigned URL –∏ —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (—á–µ—Ä–µ–∑ ffprobe)

### üöÄ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

* `GET /videos/presign-upload/` ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `presigned PUT URL` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –≤ MinIO (—Ç–µ–ø–µ—Ä—å –∑–∞—â–∏—â—ë–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π).
* `POST /videos/` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î –∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —Ñ–æ–Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ (–≤ —Ñ–æ–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `process_video`).

### üì• –ó–∞–≥—Ä—É–∑–∫–∞ –≤ MinIO (—Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫)

1. –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç `upload_url` –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É.
2. –ö–ª–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–µ–æ –≤ MinIO —á–µ—Ä–µ–∑ PUT-–∑–∞–ø—Ä–æ—Å.
3. –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `POST /videos/`, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.
4. –ë—ç–∫–µ–Ω–¥ –∑–∞–ø—É—Å–∫–∞–µ—Ç `process_video`, –∫–æ—Ç–æ—Ä—ã–π:

   * —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É URL
   * –ø—Ä–æ–±—É–µ—Ç –µ–≥–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `ffprobe`
   * –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `duration`, `mime_type`, `file_size`
   * –µ—Å–ª–∏ –Ω–µ—É–¥–∞—á–Ω–æ ‚Äî —Å—Ç–∞–≤–∏—Ç —Å—Ç–∞—Ç—É—Å `rejected`

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

* üîì –í–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **–ø—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º** –≤ MinIO, –∏–Ω–∞—á–µ `ffprobe` –Ω–µ —Å–º–æ–∂–µ—Ç –µ–≥–æ —Å–∫–∞—á–∞—Ç—å.
* ‚õî –í–∏–¥–µ–æ –¥–∞–∂–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `rejected`, –µ—Å–ª–∏ `ffprobe` –Ω–µ –ø–æ–ª—É—á–∏—Ç —Ñ–∞–π–ª.
* üëÅ‚Äçüó® –ü–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (thumbnail), –≤–∏–¥–µ–æ—Ñ–∏—á–∏, –æ—á–µ—Ä–µ–¥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
* üë§ –ù–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –≤–∞–∫–∞–Ω—Å–∏—è–º –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∫–∞–∫ –∫ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç—è–º (—Ç–æ–ª—å–∫–æ –ø–æ ID).

---

## üõ† –¶–µ–ª–µ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ)

| –¶–µ–ª—å                                                                 | –°—Ç–∞—Ç—É—Å     |
| -------------------------------------------------------------------- | ---------- |
| ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è presign-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞                                      | ‚úîÔ∏è –°–¥–µ–ª–∞–Ω–æ |
| üì¶ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ä–∞–∑–º–µ—Ä–∞, —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ | ‚úîÔ∏è –°–¥–µ–ª–∞–Ω–æ |
| üì∏ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è thumbnail (–ø—Ä–µ–≤—å—é)                                      | ‚ùå –í –ø–ª–∞–Ω–∞—Ö |
| üõ°Ô∏è –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∏–¥–µ–æ –≤ MinIO + –≤—Ä–µ–º–µ–Ω–Ω—ã–µ signed —Å—Å—ã–ª–∫–∏       | ‚ùå –í –ø–ª–∞–Ω–∞—Ö |
| üîÅ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö                           | ‚ùå –í –ø–ª–∞–Ω–∞—Ö |
| üìÇ –ü—Ä–∏–≤—è–∑–∫–∞ –≤–∏–¥–µ–æ –∫ –≤–∞–∫–∞–Ω—Å–∏—è–º                                        | ‚ùå –í –ø–ª–∞–Ω–∞—Ö |
| üéûÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ –∑–∞—â–∏—â—ë–Ω–Ω—ã–π URL                 | ‚ùå –í –ø–ª–∞–Ω–∞—Ö |

---

## üß™ –ü—Ä–∏–º–µ—Ä –ø–æ—Ç–æ–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (—Ä—É—á–Ω–æ–π)

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å URL
curl -H "Authorization: Bearer <token>" https://your-api.com/videos/presign-upload/

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
curl -X PUT -T video.mp4 "<upload_url>"

# 3. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
curl -X POST https://your-api.com/videos/ \
     -H "Authorization: Bearer <token>" \
     -H "Content-Type: application/json" \
     -d '{"title": "Test", "description": "...", "s3_key": "videos/xyz.mp4", "is_public": true}'
```

---

## üß© –ú–æ–¥–µ–ª—å `Video`

| –ü–æ–ª–µ                        | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| --------------------------- | --- | ------------------------------ |
| `id`                        | int | ID –≤–∏–¥–µ–æ                       |
| `title`                     | str | –ù–∞–∑–≤–∞–Ω–∏–µ                       |
| `description`               | str | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| `s3_key`                    | str | –ü—É—Ç—å –∫ –≤–∏–¥–µ–æ –≤ MinIO           |
| `thumbnail_url`             | str | –ü—É—Ç—å –∫ –ø—Ä–µ–≤—å—é (–≤ –±—É–¥—É—â–µ–º)      |
| `status`                    | str | `pending`, `ready`, `rejected` |
| `duration`                  | int | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö        |
| `file_size`                 | int | –†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö                |
| `mime_type`                 | str | MIME-—Ç–∏–ø (video/mp4 –∏ —Ç.–ø.)    |
| `created_by` / `updated_by` | int | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                |

---

## üß≠ –ß—Ç–æ –¥–∞–ª—å—à–µ

* [ ] –°–¥–µ–ª–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –≤–∏–¥–µ–æ **–≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π bucket** –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `presigned GET` –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
* [ ] –í—ã–¥–µ–ª–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
* [ ] –î–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–µ–≤—å—é (thumbnail)
* [ ] –•—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (progress, error logs –∏ —Ç.–¥.)
* [ ] –°–≤—è–∑–∞—Ç—å –≤–∏–¥–µ–æ —Å –≤–∞–∫–∞–Ω—Å–∏—è–º–∏ (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)

---